<!DOCTYPE html>
<html class="dark" lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Visão Geral do Agente Prospectador</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0db9f2",
                        "background-light": "#f5f8f8",
                        "background-dark": "#101e22",
                        "surface-light": "#ffffff",
                        "surface-dark": "#18282e",
                        "border-light": "#e2e8f0",
                        "border-dark": "#2a3b42",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-800 dark:text-slate-200 h-screen flex overflow-hidden font-display transition-colors duration-200">
    <!-- Sidebar -->
    <aside
        class="w-64 bg-surface-light dark:bg-surface-dark border-r border-border-light dark:border-border-dark flex-col hidden md:flex z-20">
        <div class="p-6 flex items-center gap-3">
            <div
                class="w-10 h-10 rounded-xl bg-primary flex items-center justify-center shrink-0 shadow-lg shadow-primary/20">
                <span class="material-symbols-outlined text-white text-2xl">smart_toy</span>
            </div>
            <div class="flex flex-col">
                <h1 class="font-bold text-lg leading-tight dark:text-white text-slate-900">Prospectador</h1>
                <div class="flex items-center gap-1.5">
                    {% if system_status == 'online' %}
                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                    <span class="text-xs text-slate-500 dark:text-slate-400 font-medium">Sistema Online</span>
                    {% elif system_status == 'stalled' %}
                    <span class="w-2 h-2 rounded-full bg-orange-500"></span>
                    <span class="text-xs text-orange-500 font-medium">Lento/Parado</span>
                    {% else %}
                    <span class="w-2 h-2 rounded-full bg-red-500"></span>
                    <span class="text-xs text-red-500 font-bold">OFFLINE</span>
                    {% endif %}
                </div>
            </div>
        </div>
        <nav class="flex-1 px-4 py-4 flex flex-col gap-2 overflow-y-auto">
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary/10 text-primary dark:bg-primary/20 dark:text-primary font-medium"
                href="/">
                <span class="material-symbols-outlined filled">dashboard</span>
                Visão Geral
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/5 transition-colors font-medium"
                href="/leads">
                <span class="material-symbols-outlined">search</span>
                Buscar Leads
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/5 transition-colors font-medium"
                href="/manage">
                <span class="material-symbols-outlined">group</span>
                Gerenciar Leads
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/5 transition-colors font-medium"
                href="/chat">
                <span class="material-symbols-outlined">chat</span>
                Chat
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/5 transition-colors font-medium"
                href="/analytics">
                <span class="material-symbols-outlined">bar_chart</span>
                Analytics
            </a>
        </nav>
        <div class="p-4 border-t border-border-light dark:border-border-dark">
            <!-- User Profile -->
            <div
                class="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 cursor-pointer transition-colors">
                <div class="w-8 h-8 rounded-full bg-cover bg-center"
                    style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBMGtEQ3epbYQ1arAMAIkT3ScXd_NN5Ln2CQoJZFwPkApJPuKqLL7sK3_sfLva-a9FBdOFgLBNi91QZuWG_YfTYii15PE7MVf48C4gXB7mF8lT_w-6lzWfSJWPa_0uw8mhIK5ysdc7SIVBfmk8Yk-NSBOtH5_nxz3mdQuH-vso7Qm26UbKFTjeOlClm10QVn7dxGIFiuEJPiXXd6mIh-Jv-cRvf7ozfzdtPjxlStVJRV694PGdDJlxS-UADNLqoLsKwPo3Rg9dhFn7j');">
                </div>
                <div class="flex flex-col">
                    <p class="text-sm font-medium text-slate-900 dark:text-white">Admin</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">Online</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden relative">
        <!-- Top Bar -->
        <header
            class="h-16 px-6 md:px-8 border-b border-border-light dark:border-border-dark flex items-center justify-between bg-background-light dark:bg-background-dark/95 backdrop-blur z-10 sticky top-0">
            <div class="flex items-center gap-4">
                <button class="md:hidden p-2 -ml-2 text-slate-500 hover:text-primary">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <h2 class="text-xl font-bold text-slate-900 dark:text-white hidden sm:block">Dashboard</h2>
            </div>
        </header>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-6 md:p-8">
            <div class="max-w-7xl mx-auto space-y-8">
                <!-- Page Heading -->
                <div class="flex flex-col gap-1">
                    <h2 class="text-3xl font-black tracking-tight text-slate-900 dark:text-white">Bom dia, Admin</h2>
                    <p class="text-slate-500 dark:text-slate-400">Resumo da operação hoje.</p>
                </div>

                <!-- KPI Stats Grid -->
                <!-- JINJA PLACEHOLDERS START -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- KPI 1 -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark p-6 rounded-xl shadow-sm hover:border-primary/50 transition-colors group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="p-3 rounded-lg bg-blue-500/10 text-blue-500 dark:text-blue-400">
                                <span class="material-symbols-outlined">person_add</span>
                            </div>
                        </div>
                        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mb-1">Novos Leads (Hoje)</p>
                        <p class="text-3xl font-bold text-slate-900 dark:text-white">{{ kpi_new_leads }}</p>
                    </div>
                    <!-- KPI 2 -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark p-6 rounded-xl shadow-sm hover:border-primary/50 transition-colors group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="p-3 rounded-lg bg-purple-500/10 text-purple-500 dark:text-purple-400">
                                <span class="material-symbols-outlined">send</span>
                            </div>
                        </div>
                        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mb-1">Envios do Robô</p>
                        <p class="text-3xl font-bold text-slate-900 dark:text-white">{{ kpi_sent }}</p>
                    </div>
                    <!-- KPI 3 -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark p-6 rounded-xl shadow-sm hover:border-primary/50 transition-colors group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="p-3 rounded-lg bg-orange-500/10 text-orange-500 dark:text-orange-400">
                                <span class="material-symbols-outlined">forum</span>
                            </div>
                        </div>
                        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mb-1">Respostas (Hoje)</p>
                        <p class="text-3xl font-bold text-slate-900 dark:text-white">{{ kpi_responses }}</p>
                    </div>
                </div>
                <!-- JINJA PLACEHOLDERS END -->

                <!-- Main Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 h-full">
                    <!-- Left Column: Hot Leads -->
                    <div class="lg:col-span-2 flex flex-col gap-4">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                                <span class="material-symbols-outlined text-orange-500">local_fire_department</span>
                                Retornos Quentes
                            </h3>
                        </div>
                        <div
                            class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark rounded-xl shadow-sm overflow-hidden">
                            {% for lead in hot_leads %}
                            <div
                                class="p-4 sm:p-5 flex flex-col sm:flex-row gap-4 border-b border-border-light dark:border-border-dark hover:bg-slate-50 dark:hover:bg-white/[0.02] transition-colors">
                                <div class="relative shrink-0">
                                    <div
                                        class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center text-white font-bold text-lg">
                                        {{ lead['name'][:2] }}
                                    </div>
                                    <div
                                        class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-surface-light dark:border-surface-dark flex items-center justify-center">
                                        <span
                                            class="material-symbols-outlined text-[10px] text-white font-bold">chat</span>
                                    </div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h4 class="text-base font-semibold text-slate-900 dark:text-white truncate">{{
                                        lead['name'] }}</h4>
                                    <p class="text-xs text-slate-500 mt-0.5">{{ lead['last_contact_date'] }}</p>
                                    <p
                                        class="mt-2 text-sm text-slate-600 dark:text-slate-300 line-clamp-2 bg-slate-100 dark:bg-black/30 p-2 rounded-lg border border-slate-200 dark:border-slate-700/50">
                                        {{ lead['last_message'] }}
                                    </p>
                                </div>
                            </div>
                            {% endfor %}
                            {% if not hot_leads %}
                            <div class="p-6 text-center text-slate-500 text-sm">Nenhum retorno recente.</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Right Column: Timeline -->
                    <div class="lg:col-span-1">
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-6 h-full flex flex-col">
                            <h3 class="flex items-center gap-2 text-lg font-bold text-white mb-6">
                                <span class="material-symbols-outlined text-primary">sync</span>
                                Feed do Robô
                            </h3>

                            <div id="feed-container" class="flex-1 overflow-y-auto space-y-0 pr-2 max-h-[600px]">
                                <!-- Feed items loaded via AJAX -->
                            </div>

                            <button id="load-more-btn" onclick="loadFeed()"
                                class="w-full mt-4 py-2 text-xs font-bold text-text-secondary hover:text-white border border-[#283539] hover:bg-[#283539] rounded-lg transition-colors">
                                Carregar Mais
                            </button>

                            <script>
                                let feedOffset = 0;
                                const limit = 10;

                                async function loadFeed() {
                                    const btn = document.getElementById('load-more-btn');
                                    btn.innerText = "Carregando...";

                                    try {
                                        const res = await fetch(`/api/feed?offset=${feedOffset}&limit=${limit}`);
                                        const html = await res.text();

                                        if (html.trim().length === 0) {
                                            btn.innerText = "Fim do histórico";
                                            btn.disabled = true;
                                            return;
                                        }

                                        const container = document.getElementById('feed-container');
                                        // Append HTML
                                        container.insertAdjacentHTML('beforeend', html);

                                        feedOffset += limit;
                                        btn.innerText = "Carregar Mais";
                                    } catch (e) {
                                        console.error(e);
                                        btn.innerText = "Erro ao carregar";
                                    }
                                }

                                // Initial Load
                                document.addEventListener('DOMContentLoaded', loadFeed);
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>

</html>